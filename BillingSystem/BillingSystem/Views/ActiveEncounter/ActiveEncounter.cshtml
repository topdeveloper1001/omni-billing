@using BillingSystem.Common
@using BillingSystem.Common.Common
@model BillingSystem.Models.ActiveEncounter
@{
    ViewBag.Title = "ActiveEncounter";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string defaultDiagnosisController = "Index";
    string style = "display:block;";
}

<style>
    .table-grid {
        width: 100% !important;
    }

    
    .minHeight
    {
        overflow-x:hidden;
    }
</style>

<div id="divFacility" class="white-bg">
    <div>
        @if (ViewBag.Message != null)
        {
            <h3 class="errorMsg mandatoryInfo"><span class="glyphicon glyphicon-warning-sign"></span>@ViewBag.Message</h3>
            if (ViewBag.MessageId != null && ViewBag.MessageId > 0)
            {
                if (ViewBag.MessageId == 4)
                {
                    defaultDiagnosisController = "AdditionalDiagnosis";
                }
                style = "display:none";
            }
        }
    </div>
    <div class="panel panel-default collapsecss ourcollapse bordertable" style="@style">
        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapseEncounterCharts">
            <h4 class="panel-title collapseTitle">
                <span>
                    <img src="@Url.Content("~/images/list.png")">
                </span>
                Graphs
                <a class="btn btn-default btn-sm pull-right collapse-btn">
                    <span class="glyphicon glyphicon-chevron-down"></span>
                </a>
            </h4>
        </div>
        <div id="collapseEncounterCharts" class="panel-collapse collapse in">
            <div class="panel-body">
                <div class="base-color">
                    <div class="form">
                        <div class="table-responsive">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div id="EncounterTypeChart" class="bedOccupyBorder" style="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div id="AttendingPhysicianChart" class="bedOccupyBorder" style="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default collapsecss ourcollapse bordertable">
        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapseInPatientActiveEncounterList">
            <h4 class="panel-title collapseTitle">
                <span>
                    <img src="@Url.Content("~/images/list.png")">
                </span>
                Inpatient List:
                <a class="btn btn-default btn-sm pull-right collapse-btn">
                    <span class="glyphicon glyphicon-chevron-down"></span>
                </a>
            </h4>
        </div>
        <div id="collapseInPatientActiveEncounterList" class="panel-collapse collapse in">
            <div class="panel-body">
                <div class="base-color">
                    <div class="form">
                        <div class="table-responsive" id="InPatientActiveEncounterList">
                            <input type="hidden" id="hdTempEncounterId" />
                            <input type="hidden" id="hdcolumnId" />
                            @* In Patient Encounters *@
                            @if (Model.ActiveInPatientEncounterList != null && Model.ActiveInPatientEncounterList.Any())
                            {
                                var grid = new WebGrid(Model.ActiveInPatientEncounterList, ajaxUpdateContainerId: "gridContent", canPage: false);

                                <div id="ActiveInPatientEncounterListContent">
                                    @grid.GetHtml(htmlAttributes: new { id = "ActiveInPatientEncounterGrid" }, tableStyle: "table table-grid", headerStyle: "gridHead", footerStyle: "gridFooter",
                                        rowStyle: "gridRow", alternatingRowStyle: "gridAltRow",
                                        columns: grid.Columns(
                                            grid.Column(header: "Is VIP", canSort: true, style: "col1", format: @<text>
                                            @if (!string.IsNullOrEmpty(item.PatientIsVIP))
                                            {
                                                <span style="float: left;">
                                                    <img style="height: 20px; width: 20px" src="@Url.Content("~/images/vip2.png")" />
                                                </span>
                                            } </text>),
                                            grid.Column("FirstName", "First Name", canSort: true, style: "col2"),
                                            grid.Column("LastName", "Last Name", canSort: true, style: "col3"),
                                            grid.Column("BirthDate", "Birth Date", canSort: true, style: "col4", format: @<text>@if (item.BirthDate != null)
                                            {
                                                @item.BirthDate.ToString("dd/MM/yyyy")
                                            }</text>),
                                            grid.Column("EncounterNumber", "Encounter Number", canSort: true, style: "col5"),
                                                              grid.Column("EncounterAdmitReason", "Chief Complaint", canSort: true, style: "col5"),

                                             grid.Column("PhysicianName", "Physician Name", canSort: true, style: "col5"),
                                                        //grid.Column("WaitingTime", "Wait Time", canSort: true, style: "col5"),
                                            grid.Column("EncounterStartTime", "Encounter Start", canSort: true, style: "col7", format: @<text>@if (item.EncounterStartTime != null)
                                            {
                                                @item.EncounterStartTime.ToString("dd/MM/yyyy HH:mm:ss")
                                            }</text>),
                                            grid.Column("BedName", "Bed Assigned", canSort: false, style: "col8"),
                                            grid.Column("patientBedService", "Bed ServiceCode", canSort: false, style: "col6"),
                                            grid.Column("AverageLengthofStay", "Actual Length of Stay", canSort: false, style: "col6"),
                                            grid.Column("ExpectedLengthofStay", "Expected Length of Stay", canSort: false, style: "col11", format: @<text>
                                                @if (item.ActualMoreThanExpected)
                                                {
                                                    <input type="hidden" name="hidPenality" value="High" />
                                                }<span>@item.ExpectedLengthofStay</span>
                                            </text>),
                                            grid.Column(header: "Primary Diagnosis", canSort: true, style: "colPrimaryDiagnosis", format: @<text>
                                        @if (item.IsPrimaryDiagnosisDone)
                                        {
                                            <span>@item.PrimaryDiagnosisDescription</span>
                                        }
                                        else
                                        {
                                            <span>No</span>
                                        }
                                            </text>),
                                            grid.Column(header: "Action", style: "col9", format: @<text>
                                        <div class="iconsAction">
                                            @if (Model.EncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="EditActiveEncounter('@item.EncounterID', '@item.PatientID', 6) " title="Edit Encounter">
                                                    <img src="@Url.Content("~/images/edit.png")" />
                                                </a>
                                            }

                                            @if (Model.EndEncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="DischargeIPActiveEncounter('@item.EncounterID', '@item.PatientID', 3) " title="Discharge Patient">
                                                    <img src="@Url.Content("~/images/discharge.png")" />
                                                </a>
                                            }

                                            @if (Model.EhrViewAccessible)
                                            {
                                                <a href="javascript:void(0)" title=" View EHR" onclick="RedirectEHR('@item.PatientID'); ">
                                                    <img src="@Url.Content("~/images/view_EHR.png")" />
                                                </a>
                                            }
                                            @if (Model.TransactionsViewAccessible)
                                            {
                                                <a href="javascript:void(0)" title="View Transactions" onclick="ViewTransactions('@item.EncounterID', '@item.PatientID') ">
                                                    <img src="@Url.Content("~/images/transaction-icon2.png")" />
                                                </a>
                                            }

                                            @if (Model.DiagnosisViewAccessible)
                                            {
                                                if (item.IsDRGExist)
                                                {
                                                    <a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Diagnosis View">
                                                        <img src="@Url.Content("~/images/diagnose-icon_green.png")" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Primary Diagnosis/DRG not done.">
                                                        <img src="@Url.Content("~/images/diagnose-icon_red.png")" />
                                                    </a>
                                                }
                                            }

                                            @if (Model.BillHeaderViewAccessible)
                                            {
                                                <a href="@Url.Action("Index", "BillHeader", new { id = item.EncounterID, typeId = Convert.ToInt32(QueryStringType.Encounter) })" title="Bill Header View">
                                                    <img src="@Url.Content("~/images/Billicon.png")" />
                                                </a>
                                            }
                                            @if (Model.AuthorizationViewAccessible)
                                            {
                                                if (item.IsEncounterAuthorized)
                                                {
                                                    <a href="javascript:void(0);" title="Edit Authorization" onclick="return GetEncounterAuth('@item.PatientID'); " style="float: left; margin-right: 7px; width: 15px;">
                                                        <img src="@Url.Content("~/images/Authorization_green.png")" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="javascript:void(0);" title="Get Authorization" onclick="return GetEncounterAuth('@item.PatientID'); " style="float: left; margin-right: 7px; width: 15px;">
                                                        <img id="@(string.Format("img{0}", item.PatientID))" src="@Url.Content("~/images/Authorization_red.png")" />
                                                    </a>
                                                }
                                            }
                                            @if (Model.PatientInfoViewAccessible)
                                            {
                                                <a href="@Url.Action("PatientInfo", "PatientInfo", new { patientId = item.PatientID })" style="float: left; margin-right: 7px; width: 15px;" title="Edit Patient Info">
                                                    <img src="@Url.Content("~/images/edit_patientInfo.png")" />
                                                </a>
                                            }
                                        </div>
                                            </text>)))
                                </div>
                            }
                            else
                            {
                                <h2>No Record found</h2>
                            }
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="panel panel-default collapsecss ourcollapse bordertable">
        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapseOutPatientActiveEncounterList">
            <h4 class="panel-title collapseTitle">
                <span>
                    <img src="@Url.Content("~/images/list.png")">
                </span>
                Out Patient List:
                <a class="btn btn-default btn-sm pull-right collapse-btn">
                    <span class="glyphicon glyphicon-chevron-down"></span>
                </a>
            </h4>
        </div>
        <div id="collapseOutPatientActiveEncounterList" class="panel-collapse collapse in">
            <div class="panel-body">
                <div class="base-color">
                    <div class="form">
                        <div class="table-responsive">
                            @* Out Patient Encounters *@
                            @if (Model.ActiveOutPatientEncounterList != null)
                            {
                                if (Model.ActiveOutPatientEncounterList.Any())
                                {
                                    var grid = new WebGrid(Model.ActiveOutPatientEncounterList, ajaxUpdateContainerId: "gridContent", canPage: false);
                                    @grid.GetHtml(htmlAttributes: new { id = "ActiveOutPatientEncounterGrid" }, tableStyle: "table table-grid", headerStyle: "gridHead", footerStyle: "gridFooter",
                                        rowStyle: "gridRow", alternatingRowStyle: "gridAltRow", columns: grid.Columns(
                                            grid.Column(header: "Is VIP", canSort: true, style: "col1", format: @<text>
                                            @if (!string.IsNullOrEmpty(item.PatientIsVIP))
                                            {
                                                <span style="float: left;"><img style="height: 20px; width: 20px" src="@Url.Content("~/images/vip2.png")" /></span>
                                            } </text>),
                                            grid.Column("FirstName", "First Name", canSort: true, style: "col2"),
                                            grid.Column("LastName", "Last Name", canSort: true, style: "col3"),
                                            grid.Column("BirthDate", "Birth Date", canSort: true, style: "col4", format: @<text>@if (item.BirthDate != null)
                                            {
                                                @item.BirthDate.ToString("dd/MM/yyyy")
                                            }</text>),
                                            grid.Column("EncounterNumber", "Encounter Number", canSort: true, style: "col5"),
                                                grid.Column("EncounterAdmitReason", "Chief Complaint", canSort: true, style: "col5"),

                      grid.Column("PhysicianName", "Physician Name", canSort: true, style: "col5"),
                                              grid.Column("WaitingTime", "Wait Time", canSort: true, style: "col5"),

  grid.Column("PatientStageName", "Patient Stage", canSort: true, style: "col11", format: @<text>
                                                @if (!string.IsNullOrEmpty(item.PatientStageName))
                                                {
                                            <input type="hidden" id="hdPatientStage_@item.PatientState" value="@item.PatientState" />

    <a href="javascript:void(0)" id="alertStcript_@item.EncounterID" onclick="ChangePatientStageInEncounter('@item.EncounterID', this.id,@item.PatientState) " title="Add / Edit Patient State">
        @item.PatientStageName

    </a>
                                                }
                                                else
                                                {
                                                    <a href="javascript:void(0)" id="alertStcript_@item.EncounterID" onclick="ChangePatientStageInEncounter('@item.EncounterID', this.id,'') " title="Add / Edit Patient State">
                                                        Add Patient State

                                                    </a>
                                                }
</text>),

                                            grid.Column("EncounterStartTime", "Encounter Start", canSort: true, style: "col7", format: @<text>@if (item.EncounterStartTime != null)
                                            {
                                                @item.EncounterStartTime.ToString("dd/MM/yyyy HH:mm:ss")
                                            }</text>),
                                            grid.Column(header: "Action", style: "col8", format: @<text>
                                        <div class="iconsAction">

                                            @if (Model.EncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="EditActiveEncounter('@item.EncounterID', '@item.PatientID', 2) " title="Edit Encounter">
                                                    <img src="@Url.Content("~/images/edit.png")" />
                                                </a>
                                            }

                                            @if (Model.EndEncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="DischargeActiveEncounter('@item.EncounterID', '@item.PatientID', 4) " title="Discharge Patient">
                                                    <img src="@Url.Content("~/images/discharge.png")" />
                                                </a>
                                            }

                                            @if (Model.EncounterViewAccessible)
                                            {
                                                @*<a href="javascript:void(0)" onclick="AdmitPatientEncounter('@item.EncounterID', '@item.PatientID', 5) " title="Admit Patient">
                                                        <img src="@Url.Content("~/images/admit1.png")" />
                                                    </a>*@
                                                <a href="javascript:void(0)" onclick="return OpenConfirmPopupWithThreeId('@item.EncounterID','@item.PatientID','5','Admit Patient','Are you sure you want to stop outpatient and start inpatient admit using same Encounter number?',AdmitPatientEncounter,null); " title="Admit Patient">
                                                    <img src="@Url.Content("~/images/admit1.png")" />
                                                </a>

                                            }
                                            @if (Model.EhrViewAccessible)
                                            {
                                                <a href="javascript:void(0)" title=" View EHR" onclick="RedirectEHR('@item.PatientID'); ">
                                                    <img src="@Url.Content("~/images/view_EHR.png")" />
                                                </a>
                                            }
                                            @if (Model.TransactionsViewAccessible)
                                            {
                                                <a href="javascript:void(0)" title="View Transactions" onclick="ViewTransactions('@item.EncounterID', '@item.PatientID') ">
                                                    <img src="@Url.Content("~/images/transaction-icon2.png")" />
                                                </a>
                                            }
                                            @if (Model.DiagnosisViewAccessible)
                                            {
                                                @*<a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Diagnosis View">
                                                        <img src="@Url.Content("~/images/diagnose-icon.png")" />
                                                    </a>*@
                                                if (item.IsPrimaryDiagnosisDone)
                                                {
                                                    <a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Diagnosis View">
                                                        <img src="@Url.Content("~/images/diagnose-icon_green.png")" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Add Primary Diagnosis">
                                                        <img src="@Url.Content("~/images/diagnose-icon_red.png")" />
                                                    </a>
                                                }
                                            }
                                            @if (Model.BillHeaderViewAccessible)
                                            {
                                                <a href="@Url.Action("Index", "BillHeader", new { id = item.EncounterID, typeId = Convert.ToInt32(QueryStringType.Encounter) })" title="Bill Header View">
                                                    <img src="@Url.Content("~/images/Billicon.png")" />
                                                </a>
                                            }
                                            @if (Model.AuthorizationViewAccessible)
                                            {
                                                if (item.IsEncounterAuthorized)
                                                {
                                                    <a href="javascript:void(0);" title="Edit Authorization" onclick="return GetEncounterAuth('@item.PatientID'); " style="float: left; margin-right: 7px; width: 15px;">
                                                        <img src="@Url.Content("~/images/Authorization_green.png")" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="javascript:void(0);" title="Get Authorization" onclick="return GetEncounterAuth('@item.PatientID'); " style="float: left; margin-right: 7px; width: 15px;">
                                                        <img id="@(string.Format("img{0}", item.PatientID))" src="@Url.Content("~/images/Authorization_red.png")" />
                                                    </a>
                                                }
                                            }
                                            @if (Model.PatientInfoViewAccessible)
                                            {
                                                <a href="@Url.Action("PatientInfo", "PatientInfo", new { patientId = item.PatientID })" style="float: left; margin-right: 7px; width: 15px;" title="Edit Patient Info">
                                                    <img src="@Url.Content("~/images/edit_patientInfo.png")" />
                                                </a>
                                            }
                                        </div>
                                            </text>)
                                                                                      ))
                                }
                                else
                                {
                                    <h2>No Record found</h2>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
    <div class="panel panel-default collapsecss ourcollapse bordertable">
        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapseEmerPatientEncounterList">
            <h4 class="panel-title collapseTitle">
                <span>
                    <img src="@Url.Content("~/images/list.png")">
                </span>
                Emergency List:
                <a class="btn btn-default btn-sm pull-right collapse-btn">
                    <span class="glyphicon glyphicon-chevron-down"></span>
                </a>
            </h4>
        </div>
        <div id="collapseEmerPatientEncounterList" class="panel-collapse collapse in">
            <div class="panel-body">
                <div class="base-color">
                    <div class="form">
                        <div class="table-responsive">
                            @* ER Patient Encounters *@
                            @if (Model.ActiveEmergencyEncounterList != null)
                            {
                                if (Model.ActiveEmergencyEncounterList.Any())
                                {
                                    var grid = new WebGrid(Model.ActiveEmergencyEncounterList, ajaxUpdateContainerId: "gridContent", canPage: false);
                                    @grid.GetHtml(htmlAttributes: new { id = "ActiveEREncounterGrid" }, tableStyle: "table table-grid", headerStyle: "gridHead", footerStyle: "gridFooter",
                                        rowStyle: "gridRow", alternatingRowStyle: "gridAltRow", columns: grid.Columns(
                                            grid.Column(header: "Is VIP", canSort: true, style: "col1", format: @<text>
                                            @if (!string.IsNullOrEmpty(item.PatientIsVIP))
                                            {
                                                <span style="float: left;">
                                                    <img style="height: 20px; width: 20px" src="@Url.Content("~/images/vip2.png")" />
                                                </span>
                                            }
                                            </text>),
                                            grid.Column("FirstName", "First Name", canSort: true, style: "col2"),
                                            grid.Column("LastName", "Last Name", canSort: true, style: "col3"),
                                            grid.Column("BirthDate", "Birth Date", canSort: true, style: "col4", format: @<text>@if (item.BirthDate != null)
                                            {
                                                @item.BirthDate.ToString("dd/MM/yyyy")
                                            }</text>),
                                            grid.Column("EncounterNumber", "Encounter Number", canSort: true, style: "col5"),
                                                                                   grid.Column("EncounterAdmitReason", "Chief Complaint", canSort: true, style: "col5"),

                                       grid.Column("PhysicianName", "Physician Name", canSort: true, style: "col5"),


                                     grid.Column("TriageValue", "Triage Level", canSort: true, style: "col15", format: @<text>
                                        @if (!string.IsNullOrEmpty(item.TriageValue))
                                        {
                                            <a href="javascript:void(0)" onclick="ChangeTriageLevelInEncounter('@item.EncounterID','@item.Triage') " title="Add / Edit Triage">
                                                @*@item.TriageValue*@
                                                <input type="hidden" id="hdTriageLevel_@item.Triage" value="@item.Triage" />
                                                @*<img style="width: 15px" src="@Url.Content("~/images/edit.png")" />*@
                                                @if (item.TriageValue == "Triage Level 0")
                                                {
                                                    <div style="background-color: Black; " class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">level 0</label></div>
                                                }
                                                else if (item.TriageValue == "Triage Level 1")
                                                {
                                                    <div style="background-color: red; color: white;" class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">level 1</label></div>
                                                }
                                                else if (item.TriageValue == "Triage Level 2")
                                                {
                                                    <div style="background-color: orange; " class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">level 2</label></div>
                                                }
                                                else if (item.TriageValue == "Triage Level 3")
                                                {
                                                    <div style="background-color: yellow; " class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">level 3</label></div>
                                                }
                                                else if (item.TriageValue == "Triage Level 4")
                                                {
                                                    <div style="background-color: green; color: white;" class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">level 4</label></div>
                                                }
                                                else
                                                {
                                                    <div style="background-color: #0000FF; color: white;" class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">level 5</label></div>
                                                }

                                            </a>
                                        }
                                        else
                                        {
                                            <a href="javascript:void(0)" onclick="ChangeTriageLevelInEncounter('@item.EncounterID','')" title="Add Triage Level">
                                                <div style="background-color: white;" class="color_block" id="divTL_@item.EncounterID"><label id="divTL_@item.EncounterID">Add Triage level</label></div>
                                            </a>
                                        }
                                    </text>),
                                      grid.Column("PatientStageName", "Patient Stage", canSort: true, style: "col11", format: @<text>
                                        @if (!string.IsNullOrEmpty(item.PatientStageName))
                                        {
                                            <input type="hidden" id="hdPatientStage_@item.PatientState" value="@item.PatientState" />
    <a href="javascript:void(0)" id="alertStcript_@item.EncounterID" onclick="ChangePatientStageInEncounter('@item.EncounterID', this.id,@item.PatientState) " title="Add / Edit Patient State">
        @item.PatientStageName

    </a>

                                        }
                                        else
                                        {
                                            <a href="javascript:void(0)" id="alertStcript_@item.EncounterID" onclick="ChangePatientStageInEncounter('@item.EncounterID', this.id,'') " title="Add / Edit Patient State">
                                                Add Patient State

                                            </a>
                                        }
                                    </text>),

                                    grid.Column("WaitingTime", "Wait Time", canSort: true, style: "col5"),
                                            grid.Column("EncounterStartTime", "Encounter Start", canSort: true, style: "col7", format: @<text>@if (item.EncounterStartTime != null)
                                            {
                                                @item.EncounterStartTime.ToString("dd/MM/yyyy HH:mm:ss")
                                            }</text>),
                                            grid.Column(header: "Action", style: "col8", format: @<text>
                                        <div class="iconsAction">
                                            @if (Model.EncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="EditActiveEncounter('@item.EncounterID', '@item.PatientID', 2) " title="Edit Encounter">
                                                    <img src="@Url.Content("~/images/edit.png")" />
                                                </a>
                                            }

                                            @if (Model.EndEncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="DischargeActiveEncounter('@item.EncounterID', '@item.PatientID', 4) " title="End Patient">
                                                    <img src="@Url.Content("~/images/discharge.png")" />
                                                </a>
                                            }

                                            @if (Model.EncounterViewAccessible)
                                            {
                                                <a href="javascript:void(0)" onclick="AdmitPatientEncounter('@item.EncounterID', '@item.PatientID', 5) " title="Admit Patient">
                                                    <img src="@Url.Content("~/images/admit1.png")" />
                                                </a>
                                            }
                                            @if (Model.EhrViewAccessible)
                                            {
                                                <a href="javascript:void(0)" title=" View EHR" onclick="RedirectEHR('@item.PatientID'); ">
                                                    <img src="@Url.Content("~/images/view_EHR.png")" />
                                                </a>
                                            }
                                            @if (Model.TransactionsViewAccessible)
                                            {
                                                <a href="javascript:void(0)" title="View Transactions" onclick="ViewTransactions('@item.EncounterID', '@item.PatientID') ">
                                                    <img src="@Url.Content("~/images/transaction-icon2.png")" />
                                                </a>
                                            }
                                            @if (Model.DiagnosisViewAccessible)
                                            {
                                                @*<a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Diagnosis View">
                                                        <img src="@Url.Content("~/images/diagnose-icon.png")" />
                                                    </a>*@
                                                if (item.IsPrimaryDiagnosisDone)
                                                {
                                                    <a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Add/Edit Diagnosis">
                                                        <img src="@Url.Content("~/images/diagnose-icon_green.png")" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="@Url.Action(defaultDiagnosisController, "Diagnosis", new { pId = @item.PatientID, eId = @item.EncounterID })" title="Primary Diagnosis not done.">
                                                        <img src="@Url.Content("~/images/diagnose-icon_red.png")" />
                                                    </a>
                                                }
                                            }
                                            @if (Model.BillHeaderViewAccessible)
                                            {
                                                <a href="@Url.Action("Index", "BillHeader", new { id = item.EncounterID, typeId = Convert.ToInt32(QueryStringType.Encounter) })" title="Bill Header View">
                                                    <img src="@Url.Content("~/images/Billicon.png")" />
                                                </a>
                                            }
                                            @if (Model.AuthorizationViewAccessible)
                                            {
                                                if (item.IsEncounterAuthorized)
                                                {
                                                    <a href="javascript:void(0);" title="Edit Authorization" onclick="return GetEncounterAuth('@item.PatientID'); " style="float: left; margin-right: 7px; width: 15px;">
                                                        <img src="@Url.Content("~/images/Authorization_green.png")" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="javascript:void(0);" title="Get Authorization" onclick="return GetEncounterAuth('@item.PatientID'); " style="float: left; margin-right: 7px; width: 15px;">
                                                        <img id="@(string.Format("img{0}", item.PatientID))" src="@Url.Content("~/images/Authorization_red.png")" />
                                                    </a>
                                                }
                                            }
                                            @if (Model.PatientInfoViewAccessible)
                                            {
                                                <a href="@Url.Action("PatientInfo", "PatientInfo", new { patientId = item.PatientID })" style="float: left; margin-right: 7px; width: 15px;" title="Edit Patient Info">
                                                    <img src="@Url.Content("~/images/edit_patientInfo.png")" />
                                                </a>
                                            }
                                        </div>
                                            </text>)))
                                }
                                else
                                {
                                    <h2>No Record found</h2>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @* Authorization Div Pop up *@

    <div id="divhidepopup1" class="hidePopUp" style="display: none;">
        <div class="popup-coverbg"></div>
        <div class="popup-frame">
            <div class="popup-main" style="margin: 50px auto">
                <div class="popup-content" style="min-height: 500px;">
                    <div class="popup-close" onclick=" $('.hidePopUp').hide(); $.validationEngine.closePrompt('.formError', true);">X</div>
                    <div class="minHeight" style="height: 570px;">
                        <div id="authorizationdiv"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div id="divhidepopup21" class="patient_popup" style="display: none;">
        <div class="popup-coverbg"></div>
        <div class="popup-frame">
            <div class="popup-main">
                <div class="popup-content">
                    <div class="popup-close" onclick=" $('.patient_popup').hide(); $.validationEngine.closePrompt('.formError', true);">X</div>
                    <h2>Patient Triage Level</h2>
                    <ul id="divTriagePopop"></ul>
                    @*<input class="btn btn-primary btn-sm" type="button" onclick="AddUpdateTriage(); $('.hidePopUp').hide(); $.validationEngine.closePrompt('.formError', true);" name="Save" value="Save" />*@
                    <input class="btn btn-primary btn-sm" type="button" onclick="return OpenConfirmPopup(null, 'Add/Update Patient Triage', 'This action will change the Current Encounters Triage Level. Continue?', AddUpdateTriage, null); $.validationEngine.closePrompt('.formError', true);" name="Save" value="Save" />

                </div>
            </div>
        </div>
    </div>

    <div id="divhidepopup121" class="patient_popup" style="display: none;">
        <div class="popup-coverbg"></div>
        <div class="popup-frame">
            <div class="popup-main">
                <div class="popup-content" style="min-height:235px;">
                    <div class="popup-close" onclick=" $('.patient_popup').hide(); $.validationEngine.closePrompt('.formError', true);">X</div>
                    <h2>Patient Stage</h2>
                    <ul id="divPatientStatePopop"></ul>
                    @*<input type="button" class="btn btn-primary btn-sm" onclick="AddUpdatePatientState(); $('.hidePopUp').hide(); $.validationEngine.closePrompt('.formError', true);" name="Save" value="Save" />*@
                    <input type="button" class="btn btn-primary btn-sm" onclick="return OpenConfirmPopup(null,'Add/Update Patient Stage','This action will change the Current Encounters Patient Stage. Continue?',AddUpdatePatientState,null);  $('.hidePopUp').hide(); $.validationEngine.closePrompt('.formError', true);" name="Save" value="Save" />

                </div>
            </div>
        </div>
    </div>

    @*<div id="divConfirmVirtualDischargeBox" class="a" style="display: none; cursor: default">
            <input type="hidden" id="hidVirtualDischargeEncId" />
            <input type="hidden" id="hidVirtualDischargePatientId" />
            <input type="hidden" id="hidVirtualDischargeMessageId" />
            <div class="modal-header">
                <h5 id="h5title" class="modal-title"></h5>
            </div>
            <div class="modal-body">
                <h5 id="h5Message"></h5>
            </div>
            <div class="modal-footer">
                <input type="button" id="btnVirtualDischargeConfirm" class="btn btn-sm btn-primary" value="Yes" />
                <input type="button" id="btnVirtualDischargeCancel" class="btn btn-sm btn-default" value="No" />
            </div>
        </div>*@


    <!-- Modal -->
    <div class="modal fade" id="divConfirmVirtualDischargeBox" role="dialog">
        <div class="vertical-alignment-helper">
            <div class="modal-dialog modal-sm warning_popup vertical-align-center">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" id="h5title">Modal Header</h4>
                    </div>
                    <div class="modal-body">
                        <h5 id="h5Message"></h5>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" id="hidVirtualDischargeEncId" />
                        <input type="hidden" id="hidVirtualDischargePatientId" />
                        <input type="hidden" id="hidVirtualDischargeMessageId" />
                        <input type="button" id="btnVirtualDischargeConfirm" class="btn btn-sm btn-primary" value="Yes" />
                        <input type="button" id="btnVirtualDischargeCancel" class="btn btn-sm btn-default" value="No" />
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="clear"></div>

    <script src="~/Scripts/ActiveEncounter/ActiveEncounter.js?@Helpers.CurrentAssemblyTicks"></script>
    <script src="~/Scripts/Common/confirmEvents.js?@Helpers.CurrentAssemblyTicks"></script>

    <script>
        $(function () {


            $("#ActiveInPatientEncounterGrid tbody tr").each(function (i, row) {
                var $actualRow = $(row);
                if ($actualRow.find('.col11 input[type="hidden"]').val() == 'High') {
                    $actualRow.addClass('rowColor10');
                } else {
                    $actualRow.removeClass('rowColor10');
                }
            });
            if ($('#ActiveInPatientEncounterGrid tr').length > 7) {
                $('#ActiveInPatientEncounterGrid').fixedHeaderTable({ cloneHeadToFoot: true, altClass: 'odd', autoShow: true });
            }
            if ($('#ActiveOutPatientEncounterGrid tr').length > 7) {
                $('#ActiveOutPatientEncounterGrid').fixedHeaderTable({ cloneHeadToFoot: true, altClass: 'odd', autoShow: true });
            }
            if ($('#ActiveEREncounterGrid tr').length > 7) {
                $('#ActiveEREncounterGrid').fixedHeaderTable({ cloneHeadToFoot: true, altClass: 'odd', autoShow: true });
            }
            ActiveEncounterData();
        });

        function ActiveEncounterData() {
            $.ajax({
                type: "POST",
                url: '/ActiveEncounter/GetActiveEncountersChartData',
                async: true,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: null,
                success: function (data) {
                    if (data != null) {
                        var dataArray = new Array();
                        var chartData = new Array();
                        for (var i = 0; i < data.length; i++) {
                            if (data[i].Total == 1) {
                                dataArray.push({ name: data[i].Descrip, y: data[i].Value });
                            } else {
                                chartData.push({ name: data[i].Descrip, y: data[i].Value });
                            }
                        }
                        ShowOnePieChartWithColors('EncounterTypeChart', dataArray, "Encounter Type");
                        ShowOnePieChartWithColors('AttendingPhysicianChart', chartData, "Encounter By- Physician");
                    }
                },
                error: function (msg) {
                }
            });
        }
    </script>
</div>
@*<script>
          SetGridSorting(SortInPatientEncounter, "#ActiveInPatientEncounterListContent");
    </script>*@